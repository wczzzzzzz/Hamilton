using CairoMakie

ğ‘˜ = 100.0
ğ‘š = 1.0
qÌ‡â‚€ = 5.0
qâ‚€ = 1.0

fig = Figure()
Axis(fig[1, 1])
ğ‘¡ = 0.0:0.001:1.0
ğœ” = (ğ‘˜/ğ‘š)^0.5
ğ‘¥ = qâ‚€.*cos.(ğœ”.*ğ‘¡) + qÌ‡â‚€/ğœ”.*sin.(ğœ”.*ğ‘¡)
lines!(ğ‘¡, ğ‘¥, color = :black)

t = 0.0:0.1:1.0
nâ‚š = length(t)
nâ‚‘ = nâ‚š-1

# FEM weak LM
k = zeros(nâ‚š,nâ‚š)
f = zeros(nâ‚š)

for i in 1:nâ‚‘
    tâ‚ = t[i]
    tâ‚‚ = t[i+1]
    ğ¿ = tâ‚‚ - tâ‚
    k[i,i] += ğ‘š/ğ¿ - ğ‘˜/3*ğ¿
    k[i,i+1] += -ğ‘š/ğ¿ - ğ‘˜/6*ğ¿
    k[i+1,i] += -ğ‘š/ğ¿ - ğ‘˜/6*ğ¿
    k[i+1,i+1] += ğ‘š/ğ¿ - ğ‘˜/3*ğ¿
end

ğ‘ƒâ‚€ = ğ‘š*qÌ‡â‚€
f[1] -= ğ‘ƒâ‚€

káµ¥ = k[1:nâ‚š-1,:]
fáµ¥ = f[1:nâ‚š-1]

Î± = 1e8
k[1,1] += Î±
f[1] += Î±*qâ‚€

d = [k káµ¥';káµ¥ zeros(nâ‚š-1,nâ‚š-1)]\[f;fáµ¥]
d = d[1:nâ‚š]

lines!(t, d, color = :blue)

# FEM weak test
# k = zeros(nâ‚š,nâ‚š)
# f = zeros(nâ‚š)

# for i in 1:nâ‚‘
#     tâ‚ = t[i]
#     tâ‚‚ = t[i+1]
#     ğ¿ = tâ‚‚ - tâ‚
#     k[i,i] += ğ‘š/ğ¿ - ğ‘˜/3*ğ¿
#     k[i,i+1] += -ğ‘š/ğ¿ - ğ‘˜/6*ğ¿
#     k[i+1,i] += -ğ‘š/ğ¿ - ğ‘˜/6*ğ¿
#     k[i+1,i+1] += ğ‘š/ğ¿ - ğ‘˜/3*ğ¿
# end

# káµ¥ = k[1:nâ‚š-1,1:nâ‚š-1]
# fáµ¥ = f[1:nâ‚š-1]

# ğ‘ƒâ‚€ = ğ‘š*qÌ‡â‚€
# f[1] -= ğ‘ƒâ‚€
# Î± = 1e8
# k[1,1] += Î±
# f[1] += Î±*qâ‚€

# d = k\f
# d[1:nâ‚š-1] .-=  káµ¥\fáµ¥

# lines!(t, d, color = :red)

fig