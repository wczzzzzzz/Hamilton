using CairoMakie

๐ = 1e3
๐ = 1.0
qฬโ = 5.0
qโ = 1.0

fig = Figure()
Axis(fig[1, 1])
๐ก = 0.0:0.01:1.0
๐ = (๐/๐)^0.5
๐ฅ = qโ.*cos.(๐.*๐ก) + qฬโ/๐.*sin.(๐.*๐ก)
lines!(๐ก, ๐ฅ, color = :black)

dt = 0.1
t = collect(0.0:dt:1.0)
nโ = length(t)
nโ = nโ-1
# for i in 2:nโ-1
#     t[i] += dt*(rand()-0.5)
# end

# FEM weak LM
k = zeros(nโ,nโ)
f = zeros(nโ)

for i in 1:nโ
    tโ = t[i]
    tโ = t[i+1]
    ๐ฟ = tโ - tโ
    k[i,i] += ๐/๐ฟ - ๐/3*๐ฟ
    k[i,i+1] += -๐/๐ฟ - ๐/6*๐ฟ
    k[i+1,i] += -๐/๐ฟ - ๐/6*๐ฟ
    k[i+1,i+1] += ๐/๐ฟ - ๐/3*๐ฟ
end

๐โ = ๐*qฬโ
f[1] -= ๐โ

ฮฑ = 1e8
kแต = zeros(nโ,nโ)
fแต = zeros(nโ)
kแต[1,1] += ฮฑ
fแต[1] += ฮฑ*qโ
kแต = zeros(nโ,nโ)
fแต = zeros(nโ)
kแต[nโ,nโ] += ฮฑ

d = [k+kแต -k;-k kแต]\[fแต;-f+fแต]
# d = [k+kแต k;k kแต]\[f+fแต;f+fแต]
d = d[1:nโ]

lines!(t, d, color = :blue)

# FEM weak test
# k = zeros(nโ,nโ)
# f = zeros(nโ)

# for i in 1:nโ
#     tโ = t[i]
#     tโ = t[i+1]
#     ๐ฟ = tโ - tโ
#     k[i,i] += ๐/๐ฟ - ๐/3*๐ฟ
#     k[i,i+1] += -๐/๐ฟ - ๐/6*๐ฟ
#     k[i+1,i] += -๐/๐ฟ - ๐/6*๐ฟ
#     k[i+1,i+1] += ๐/๐ฟ - ๐/3*๐ฟ
# end

# kแตฅ = k[1:nโ-1,1:nโ-1]
# fแตฅ = f[1:nโ-1]

# ๐โ = ๐*qฬโ
# f[1] -= ๐โ
# ฮฑ = 1e8
# k[1,1] += ฮฑ
# f[1] += ฮฑ*qโ

# d = k\f
# d[1:nโ-1] .-=  kแตฅ\fแตฅ

# lines!(t, d, color = :red)

fig