using CairoMakie, LinearAlgebra

ğ‘˜ = 1e3
ğ‘š = 1.0
qÌ‡â‚€ = 1.0
qâ‚€ = 0.0

fig = Figure()
Axis(fig[1, 1])
ğ‘¡ = 0.0:0.1:1.0
ğœ” = (ğ‘˜/ğ‘š)^0.5
ğ‘¥ = qâ‚€.*cos.(ğœ”.*ğ‘¡) + qÌ‡â‚€/ğœ”.*sin.(ğœ”.*ğ‘¡)
lines!(ğ‘¡, ğ‘¥, color = :black)

t = 0.0:0.1:1.0
nâ‚š = length(t)
nâ‚‘ = nâ‚š-1

# FEM
k_ = zeros(nâ‚š,nâ‚š)

for i in 1:nâ‚‘
    tâ‚ = t[i]
    tâ‚‚ = t[i+1]
    ğ¿ = tâ‚‚ - tâ‚
    k_[i,i] += ğ‘š/ğ¿ - ğ‘˜/3*ğ¿
    k_[i,i+1] += -ğ‘š/ğ¿ - ğ‘˜/6*ğ¿
    k_[i+1,i] += -ğ‘š/ğ¿ - ğ‘˜/6*ğ¿
    k_[i+1,i+1] += ğ‘š/ğ¿ - ğ‘˜/3*ğ¿
end

# F1 formulation: Î´qâ‚€ = 0, Î´qÌ‡â‚€ = 0
k = zeros(nâ‚š,nâ‚š)
k .= k_
f = zeros(nâ‚š)
ğ¿ = t[nâ‚š]-t[nâ‚š-1]
k[nâ‚š,nâ‚š-1] -= -ğ‘š/ğ¿
k[nâ‚š,nâ‚š] -= ğ‘š/ğ¿

ğ¿ = t[2]-t[1]
f .-= k[:,1]*qâ‚€
f .-= k[:,2]*(qâ‚€+ğ¿*qÌ‡â‚€)
k[1,:] .= 0.0
k[2,:] .= 0.0
k[:,1] .= 0.0
k[:,2] .= 0.0
k[1,1] = 1.0
k[2,2] = 1.0
f[1] = qâ‚€
f[2] = qâ‚€+ğ¿*qÌ‡â‚€

d = k\f

lines!(t, d, color = :blue)

# F2 formulation: Î´qâ‚€ = 0, Î´qâ‚ = 0
k = zeros(nâ‚š,nâ‚š)
k .= k_
f = zeros(nâ‚š)
ğ¿ = t[2]-t[1]
f .-= k[:,1]*qâ‚€
f .-= k[:,2]*(qâ‚€+ğ¿*qÌ‡â‚€)
k[1,:] .= 0.0
k[nâ‚š,:] .= 0.0
k[:,1] .= 0.0
k[:,2] .= 0.0
k[1,1] = 1.0
k[nâ‚š,2] = 1.0
f[1] = qâ‚€
f[nâ‚š] = qâ‚€+ğ¿*qÌ‡â‚€

d = k\f

lines!(t, d, color = :orange)

fig

# val = eigvals(k)